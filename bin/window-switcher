#!/usr/bin/env bash

# Get windows as JSON from yabai (all spaces, instant)
windows=$(/opt/homebrew/bin/yabai -m query --windows)

# Parse JSON, format for fzf (include space number)
# Filter to visible/standard windows, format as "space | title | app [id]"
selected=$(echo "$windows" | /opt/homebrew/bin/jq -r '
  .[] |
  select(.["is-visible"] == true or .["is-minimized"] == false) |
  select(.title != "") |
  "[\(.space)] \(.title) | \(.app) [\(.id)]"
' | /opt/homebrew/bin/fzf --height=100% --reverse)

if [ -n "$selected" ]; then
    # Extract window ID from "[id]" at end
    window_id=$(echo "$selected" | grep -oE '\[[0-9]+\]$' | tr -d '[]')
    /opt/homebrew/bin/yabai -m window --focus "$window_id"
fi
