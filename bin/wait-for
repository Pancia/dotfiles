#!/usr/bin/env bash

SILENT=false
if [ "$1" = "--silent" ]; then
  SILENT=true
  shift
fi

if [ "$SILENT" = false ]; then
  echo "[wait-for]: Waiting for \`test -e $1\`, will execute \`${@:2}\`"
fi

i=0
while [ ! -e "$1" ]; do
  sleep 1
  ((i++))
  if [ "$SILENT" = false ]; then
    printf "\rWaited: $i seconds"
  fi
done

if [ "$SILENT" = false ]; then
  echo; echo "Done waiting for \`$1\`"; echo "Executing: \`${@:2}\`:"
fi

"${@:2}"
