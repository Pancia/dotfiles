#!/bin/bash

valid_types="music audio video text notes"

if [ -z "$1" ]; then
    while true; do
        echo "Enter the ytdl type:"
        echo "$valid_types"
        read -r ytdl_type
        if [[ " $valid_types " =~ " $ytdl_type " ]]; then
            break
        else
            echo "ERROR: Invalid type '$ytdl_type'. Please try again."
        fi
    done
elif [ "$1" == "clipboard" ]; then
    arg2="$(pbpaste)"
    while true; do
        echo "Enter the ytdl type:"
        echo "$valid_types"
        read -r ytdl_type
        if [[ " $valid_types " =~ " $ytdl_type " ]]; then
            break
        else
            echo "ERROR: Invalid type '$ytdl_type'. Please try again."
        fi
    done
else
    ytdl_type="$1"
    if [[ ! " $valid_types " =~ " $ytdl_type " ]]; then
        echo "ERROR: Invalid type '$ytdl_type'"
        echo "Valid types are: $valid_types"
        exit 1
    fi
fi

if [ "$1" == "clipboard" ]; then
    echo null
elif [ -z "$2" ]; then
    echo "Please enter the youtube ID:"
    read -r arg2
else
    arg2="$2"
fi

if [[ "$arg2" =~ ^(https|www|youtube) ]]; then
    video_id=$(echo "$arg2" | sed 's/.*v=\([^&]*\).*/\1/')
else
    video_id="$arg2"
fi

echo DOWNLOADING TO ~/Downloads/$video_id.single.$ytdl_type.ytdl

echo 'please ignore' > ~/Downloads/"$video_id.single.$ytdl_type.ytdl"

ruby ~/dotfiles/misc/watch/ytdl/ytdl.rb --show-progress
