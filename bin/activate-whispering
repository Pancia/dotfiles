#!/usr/bin/osascript

set logFile to "/tmp/activate-whispering.log"
do shell script "echo '=== Starting activation ===' >> " & logFile

# Trigger cmd-alt-shift-t at start
tell application "System Events"
    keystroke "t" using {command down, option down, shift down}
    do shell script "echo 'Triggered cmd-alt-shift-t at start' >> " & logFile
end tell

delay 0.1

# Use Hammerspoon to focus and raise the window (since it's on all desktops, we can see it)
do shell script "echo 'Calling hammerspoon to focus window...' >> " & logFile
set hsResult to do shell script "/Users/anthony/Developer/bin/hs -c 'local app = hs.application.find(\"Whispering\"); if not app then hs.printf(\"[activate-whisper]: App not running, launching...\"); hs.application.open(\"Whispering\"); hs.timer.usleep(1000000); app = hs.application.find(\"Whispering\"); if not app then return \"failed to launch\" end end; local wins = app:allWindows(); hs.printf(\"[activate-whisper]: Found %d windows\", #wins); if #wins > 0 then local win = wins[1]; hs.printf(\"[activate-whisper]: Focusing window: %s\", win:title() or \"nil\"); if win:isMinimized() then win:unminimize() end; win:focus(); win:raise(); return \"focused and raised window\" else return \"no windows found after launch\" end' 2>&1"
do shell script "echo 'Hammerspoon result: " & hsResult & "' >> " & logFile

delay 0.2
tell application "System Events"
    keystroke "z" using {command down, option down, shift down}
    do shell script "echo 'Triggered keystroke' >> " & logFile
end tell

do shell script "echo '=== Completed ===' >> " & logFile
